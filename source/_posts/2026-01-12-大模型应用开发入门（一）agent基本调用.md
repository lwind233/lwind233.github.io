---
title: 大模型应用开发入门（一）Agent基本调用
date: 2026-01-13T10:12:00
tags:
  - agent
  - springai
  - java
categories:
  - 大模型应用开发
---
## agent注册

用于和大模型api交互的类都继承了ChatClient接口。

```java
@Bean("deepseek-chat")
public ChatClient deepseekChatClient(DeepSeekChatModel deepSeekChatModel){
    return ChatClient.create(deepSeekChatModel);
}
```

## agent调用

单轮对话中，可以直接链式调用

```java
@Autowired
public ChatClient agent;

void test(){
    ChatResponse output = agent.call()
                .prompt()
                .user()
                .call()
                .chatResponse();

    AssistantMessage assistant = output
                             .getResult()
                             .getOutput()
}
```

ChatClient交互的输入和输出都要依赖Message接口的实现类

而多轮对话中，为了使得模型有上下文记忆，需要其存储先前的消息并再次发送给大模型

### 消息

消息可以分为四类

* 用户消息 UserMessage
* 大模型消息 AssistantMessage
* 系统提示 SystemMessage
* 工具消息 ToolResponseMessage

### 聊天记忆

ChatMemory 接口定义了聊天对话记忆的存储机制，提供添加消息、检索消息及清空对话历史的方法。

常用方法

* add(String, Message) 指定会话id，添加消息
* get(String) 根据指定的会话id按添加顺序返回消息列表
* clear(String) 根据指定的会话id清空消息列表

#### MessageWindowChatMemory

MessageWindowChatMemory 维护固定容量的消息窗口（默认 20 条）。当消息超限时，自动移除较早的对话消息（始终保留系统消息）。

```java
MessageWindowChatMemory memory = MessageWindowChatMemory.builder()
    .maxMessages(10)
    .build();
此为 Spring AI 自动配置 ChatMemory Bean 时采用的默认消息类型。
```

可以将历史交互统一塞入到chatMemory中，然后通过调用时的prompt方法来为模型提供上下文记忆

```java
    Prompt prompt = Prompt.builder()
            .messages(chatMemory.get(sessionId))
            .build();
    ChatResponse output = agent.call()
            .prompt(prompt)
            .call()
            .chatResponse();
```

有了这些，就可以实现一个具备多轮对话功能的agent了

还可以考虑将大模型的会话记忆入库使其持久化，实现长期记忆
