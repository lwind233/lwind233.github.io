---
title: 大模型应用开发入门（二）工具调用
tags:
  - agent
  - springai
  - java
categories:
  - 大模型应用开发
abbrlink: b55abc90
date: 2026-01-13 10:46:00
---
## 工具注册

通过@Tool注解就可以轻松的将某个方法注册为工具类

```java
    @Tool(name = "getDate", description = "获取当前的日期")
    public String getDate() {
        return LocalDateTime.now().format(DateTimeFormatter.ofPattern("yyyy-MM-dd"));
    }
```

Spring AI 将自动为 @Tool 注解方法的输入参数生成 JSON Schema。该 Schema 供模型理解如何调用工具及准备工具请求。

## 工具传入

最终使用的工具是ToolCallBack的实现类，经过注解的工具需要转换为ToolCallBack才可以被调用。

可利用MethodToolCallbackProvider类，解析多个工具类中注解了Tool的方法，将其转换为ToolCallBack数组

```java
ToolCallback[] toolCallbacks = MethodToolCallbackProvider.builder()
        .toolObjects(cityTool, dateTool, weatherTool)
        .build()
        .getToolCallbacks();
```

然后在chatClient调用时，将其传入`toolCallbacks`方法即可

## 工具解析与调用

使用默认行为时，Spring AI 会自动拦截模型的工具调用请求，执行工具并将结果返回模型。这些操作均由各 `ChatModel` 实现通过 `ToolCallingManager` 透明完成。

若想自行进行控制，需要将 `ToolCallingChatOptions` 的 
`internalToolExecutionEnabled` 属性设为 `false`。该参数需要传入prompt的`chatOptions`

此时，在通过调用chatClient获取到ChatResponse后，需要使用ToolCallingManager来执行工具调用请求

```java
ToolExecutionResult toolExecutionResult = toolCallingManager.executeToolCalls(prompt，lastChatResponse);
// prompt应包含历史消息，同时要确保lastChatResponse中含有ToolCalls请求
chatMemory.clear(sessionId);        
chatMemory.add(sessionId,toolExecutionResult.conversationHistory());
```

当大模型认为自己已经获取到了足够的信息时，其回复的消息中ToolCalls将会为空，可以据此判断当前对话是否可以结束。
